# RTC2KNG

![μ‹¤ν–‰ ν™”λ©΄](README_image.jpg)
*(μ΄λ―Έμ§€ μΊ΅μ…: ν”„λ΅μ νΈ μ‹¤ν–‰ μμ‹ ν™”λ©΄)*

## 1. κ°μ”

μ΄ ν”„λ΅μ νΈλ” WebRTC κΈ°μ μ„ ν™μ©ν•μ—¬ λ΅λ΄‡μ„ μ›κ²©μΌλ΅ μ μ–΄ν•κ³ , λ΅λ΄‡μ μΉ΄λ©”λΌ μμƒ λ° μ¤λ””μ¤λ¥Ό μ‹¤μ‹κ°„μΌλ΅ μ¤νΈλ¦¬λ° λ°›μ„ μ μλ” μ‹μ¤ν…μ…λ‹λ‹¤. PythonμΌλ΅ μ‘μ„±λ μ„λ²„λ¥Ό μ¤‘μ‹¬μΌλ΅, Python λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈ λ° λ‹¤μ–‘ν• ν•νƒμ μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ(Python GUI, μ›Ή λΈλΌμ°μ €, Unity)μ™€ μ—°λ™λ©λ‹λ‹¤.

## 2. μ£Όμ” κΈ°λ¥

* μ‹¤μ‹κ°„ λΉ„λ””μ¤/μ¤λ””μ¤ μ¤νΈλ¦¬λ° (λ΅λ΄‡ β†’ μ¤νΌλ μ΄ν„°)
* μ–‘λ°©ν–¥ λ°μ΄ν„° μ±„λ„μ„ ν†µν• λ©”μ‹μ§€ λ° μ μ–΄ λ…λ Ήμ–΄ κµν™
* λ‹¤μ¤‘ μ¤νΌλ μ΄ν„° ν™κ²½ μ§€μ› (μ„λ²„ λ΅μ§μ— λ”°λΌ νΉμ • λ΅λ΄‡μ— μ—¬λ¬ μ¤νΌλ μ΄ν„° λ™μ‹ μ—°κ²° κ°€λ¥)
* Python, μ›Ή λΈλΌμ°μ €, Unity λ“± λ‹¤μ–‘ν• ν”λ«νΌμ μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ μ§€μ›

## 3. ν”„λ΅μ νΈ κµ¬μ„± μ”μ†

* **μ‹κ·Έλ„λ§ μ„λ²„ (`server.py`)**:
    * FastAPIμ™€ Websocketsμ„ μ‚¬μ©ν•μ—¬ ν΄λΌμ΄μ–ΈνΈ κ°„ WebRTC μ‹κ·Έλ„λ§ λ©”μ‹μ§€(Offer, Answer, ICE Candidate)λ¥Ό μ¤‘κ³„ν•©λ‹λ‹¤.
    * ν΄λΌμ΄μ–ΈνΈ(λ΅λ΄‡, μ¤νΌλ μ΄ν„°) λ“±λ΅ λ° νΉμ • λ°©(Room) κΈ°λ°μ ν†µμ‹  κ·Έλ£Ή κ΄€λ¦¬λ¥Ό λ‹΄λ‹Ήν•©λ‹λ‹¤.
* **λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈ (`robot_client.py`)**:
    * μ‹¤μ  λ΅λ΄‡ λλ” λ΅λ΄‡ μ‹λ®¬λ μ΄μ… ν™κ²½μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.
    * μΉ΄λ©”λΌ, λ§μ΄ν¬ λ“±μ λ―Έλ””μ–΄ μ¥μΉλ΅λ¶€ν„° λ°μ΄ν„°λ¥Ό λ°›μ•„ μ¤νΌλ μ΄ν„°μ—κ² μ¤νΈλ¦¬λ°ν•©λ‹λ‹¤.
    * μ¤νΌλ μ΄ν„°λ΅λ¶€ν„° μ μ–΄ λ…λ Ήμ„ μμ‹ ν•μ—¬ λ΅λ΄‡μ„ λ™μ‘μ‹ν‚µλ‹λ‹¤.
    * `robot_peer_connection.py`: λ΅λ΄‡ μΈ΅μ WebRTC ν”Όμ–΄ μ—°κ²° λ° λ―Έλ””μ–΄ μ²λ¦¬λ¥Ό λ‹΄λ‹Ήν•©λ‹λ‹¤.
* **μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ**:
    * **Python μ¤νΌλ μ΄ν„° (`operator_client.py`)**:
        * PySide6λ¥Ό μ‚¬μ©ν• GUI ν™κ²½ λλ” μ½μ†” ν™κ²½μ—μ„ λ΅λ΄‡μ„ μ μ–΄ν•κ³  λ―Έλ””μ–΄λ¥Ό μμ‹ ν•©λ‹λ‹¤.
        * `operator_peer_connection.py`: Python μ¤νΌλ μ΄ν„° μΈ΅μ WebRTC ν”Όμ–΄ μ—°κ²° λ° λ―Έλ””μ–΄ μ²λ¦¬λ¥Ό λ‹΄λ‹Ήν•©λ‹λ‹¤.
    * **μ›Ή μ¤νΌλ μ΄ν„° (`operator_client.html`)**:
        * μ›Ή λΈλΌμ°μ €μ—μ„ μ‹¤ν–‰λλ” HTML/JavaScript κΈ°λ°μ μ¤νΌλ μ΄ν„° μΈν„°νμ΄μ¤μ…λ‹λ‹¤.
        * μ„λ²„ μ ‘μ† ν›„ λ΅λ΄‡μ λ―Έλ””μ–΄λ¥Ό μμ‹ ν•κ³  λ°μ΄ν„° μ±„λ„μ„ ν†µν•΄ λ©”μ‹μ§€λ¥Ό κµν™ν•  μ μμµλ‹λ‹¤.
    * **Unity μ¤νΌλ μ΄ν„°**:
        * Unity κ²μ„ μ—”μ§„μΌλ΅ κ°λ°λ μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈμ…λ‹λ‹¤. (μƒμ„Έ μ„¤μ •μ€ λ¬Έμ„ ν›„λ°λ¶€ "6. Unity μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ" μ°Έκ³ )

## 4. Python ν™κ²½ μ„¤μ • λ° μ‹¤ν–‰

μ΄ μ„Ήμ…μ—μ„λ” PythonμΌλ΅ κµ¬ν„λ μ„λ²„, λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈ, Python μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ, κ·Έλ¦¬κ³  μ›Ή μ¤νΌλ μ΄ν„°μ— λ€ν• μ„¤μ • λ° μ‹¤ν–‰ λ°©λ²•μ„ μ•λ‚΄ν•©λ‹λ‹¤.

### 4.1. Python μμ΅΄μ„± μ„¤μΉ

* **Python λ²„μ „**: Python 3.8 μ΄μƒμ„ κ¶μ¥ν•©λ‹λ‹¤.
* **λΌμ΄λΈλ¬λ¦¬ μ„¤μΉ**:
    μ΄ ν”„λ΅μ νΈλ” μ„λ²„, λ΅λ΄‡, μ¤νΌλ μ΄ν„° κ° λ¶€λ¶„μ— λ”°λΌ ν•„μ”ν• Python λΌμ΄λΈλ¬λ¦¬κ°€ λ‹¤λ¥Ό μ μμµλ‹λ‹¤. κ° ν™κ²½μ— λ§λ” `requirements` νμΌμ„ μ‚¬μ©ν•κ±°λ‚, μ•„λ μ „μ²΄ λ©λ΅μ„ μ°Έκ³ ν•μ—¬ μ„¤μΉν•  μ μμµλ‹λ‹¤. (ν”„λ΅μ νΈ λ£¨νΈμ— κ° μ»΄ν¬λ„νΈλ³„ `requirements_*.txt` νμΌμ΄ μλ‹¤λ©΄ ν•΄λ‹Ή νμΌμ„ μ‚¬μ©ν•μ„Έμ”.)

    * **κ°λ³„ `requirements` νμΌ μ‚¬μ© μ‹ (μ¶”μ²)**:
        ν”„λ΅μ νΈ λ£¨νΈμ— λ‹¤μκ³Ό κ°™μ€ νμΌλ“¤μ΄ μλ‹¤λ©΄ κ° ν™κ²½μ— λ§κ² μ„¤μΉν•©λ‹λ‹¤.
        ```bash
        # μ„λ²„ μ‹¤ν–‰ ν™κ²½μ©
        pip install -r requirements_server.txt

        # λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ ν™κ²½μ©
        pip install -r requirements_robot.txt

        # Python μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ ν™κ²½μ©
        pip install -r requirements_operator.txt

        # (μ„ νƒ) λ¨λ“  κ°λ° κ΄€λ ¨ μμ΅΄μ„± (μ: requirements_dev.txt)
        # pip install -r requirements_dev.txt
        ```

    * **μ „μ²΄ μ£Όμ” λΌμ΄λΈλ¬λ¦¬ λ©λ΅ (μλ™ μ„¤μΉ λλ” κ³µν†µ `requirements.txt` μ‚¬μ© μ‹)**:
        ```bash
        pip install fastapi uvicorn websockets requests aiortc pypubsub PySide6 pyaudio
        ```
        * `fastapi`: ν„λ€μ μ΄κ³  λΉ λ¥Έ μ›Ή ν”„λ μ„μ›ν¬ (μ„λ²„μ©)
        * `uvicorn`: ASGI μ„λ²„ (FastAPI μ‹¤ν–‰μ©)
        * `websockets`: WebSocket ν΄λΌμ΄μ–ΈνΈ λ° μ„λ²„ κµ¬ν„μ©
        * `requests`: HTTP μ”μ²­μ© (λ΅λ΄‡ λ“±λ΅ λ“±)
        * `aiortc`: Pythonμ© WebRTC λΌμ΄λΈλ¬λ¦¬
        * `pypubsub`: λ°ν–‰-κµ¬λ… λ©”μ‹μ§• ν¨ν„΄ λΌμ΄λΈλ¬λ¦¬
        * `PySide6`: Pythonμ© Qt6 λ°”μΈλ”© (Python μ¤νΌλ μ΄ν„° GUIμ©)
        * `pyaudio`: μ¤λ””μ¤ μ…μ¶λ ¥ λΌμ΄λΈλ¬λ¦¬ (μ‹μ¤ν…μ— λ”°λΌ PortAudio λ“± μ¶”κ°€ μμ΅΄μ„± μ„¤μΉ ν•„μ” κ°€λ¥)

### 4.2. μ„λ²„ μ‹¤ν–‰ (`server.py`)

1.  ν„°λ―Έλ„μ„ μ—΄κ³  ν”„λ΅μ νΈμ λ£¨νΈ λ””λ ‰ν† λ¦¬λ΅ μ΄λ™ν•©λ‹λ‹¤.
2.  λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ μ‹κ·Έλ„λ§ μ„λ²„λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤:
    ```bash
    python server.py
    ```
    λλ” `uvicorn`μ„ μ§μ ‘ μ‚¬μ©ν•  κ²½μ°:
    ```bash
    uvicorn server:app --host 0.0.0.0 --port 25000
    ```
    κΈ°λ³Έμ μΌλ΅ μ„λ²„λ” `0.0.0.0` μ£Όμ†μ `25000` ν¬νΈμ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.

### 4.3. λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ (`robot_client.py`)

1.  `robot_client.py` νμΌ μƒλ‹¨μ `SERVER_IP`μ™€ `SERVER_PORT` λ³€μλ¥Ό μ‹¤ν–‰ μ¤‘μΈ μ„λ²„μ IP μ£Όμ†μ™€ ν¬νΈλ΅ μ„¤μ •ν•©λ‹λ‹¤.
    ```python
    # robot_client.py
    SERVER_IP = 'YOUR_SERVER_IP'  # μ: '125.131.105.165' λλ” λ΅μ»¬ ν…μ¤νΈ μ‹ 'localhost'
    SERVER_PORT = 25000
    ROBOT_ID = 'test_robot'       # λ΅λ΄‡ κ³ μ  ID
    ROOM_ID = 'test_room'         # μ ‘μ†ν•  λ°© ID
    ```
2.  ν„°λ―Έλ„μ—μ„ λ‹¤μ λ…λ Ήμ–΄λ΅ λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤:
    ```bash
    python robot_client.py
    ```

### 4.4. Python μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ (`operator_client.py`)

1.  `operator_client.py` νμΌ μƒλ‹¨μ `SERVER_IP`μ™€ `SERVER_PORT` λ³€μλ¥Ό μ‹¤ν–‰ μ¤‘μΈ μ„λ²„μ IP μ£Όμ†μ™€ ν¬νΈλ΅ μ„¤μ •ν•©λ‹λ‹¤.
    ```python
    # operator_client.py
    SERVER_IP = 'YOUR_SERVER_IP'  # μ: '125.131.105.165' λλ” λ΅μ»¬ ν…μ¤νΈ μ‹ 'localhost'
    SERVER_PORT = 25000
    OPERATOR_ID = 'test_operator' # μ¤νΌλ μ΄ν„° κ³ μ  ID
    ROOM_ID = 'test_room'         # μ ‘μ†ν•  λ°© ID (λ΅λ΄‡κ³Ό λ™μΌν•΄μ•Ό ν•¨)
    ```
2.  ν„°λ―Έλ„μ—μ„ λ‹¤μ λ…λ Ήμ–΄λ΅ Python μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤:
    ```bash
    python operator_client.py
    ```

### 4.5. μ›Ή μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ (`operator_client.html`)

1.  μ›Ή λΈλΌμ°μ €λ¥Ό μ—½λ‹λ‹¤.
2.  μ£Όμ†μ°½μ— λ‹¤μ URLμ„ μ…λ ¥ν•μ—¬ μ ‘μ†ν•©λ‹λ‹¤ (125.131.105.165:25000):
    * URL ν•μ‹: `http://<μ„λ²„_IP_μ£Όμ†>:<μ„λ²„_ν¬νΈ>/static/operator_client.html?room_id=<μ ‘μ†ν• _λ°©_ID>`
    * λ΅μ»¬ ν…μ¤νΈ μ‹ μμ‹: `http://localhost:25000/static/operator_client.html?room_id=test_room`
    * μ›κ²© μ„λ²„ μ ‘μ† μ‹ μμ‹: `http://125.131.105.165:25000/static/operator_client.html?room_id=test_room`

### 4.6. λ΅μ»¬ ν™κ²½ μ „μ²΄ ν…μ¤νΈ (Python λ° μ›Ή λ¶€λ¶„)

λ΅μ»¬ λ¨Έμ‹ μ—μ„ μ„λ²„, λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈ, Python/μ›Ή μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈλ¥Ό λ¨λ‘ μ‹¤ν–‰ν•μ—¬ ν…μ¤νΈν•λ” λ°©λ²•μ…λ‹λ‹¤.

1.  **μ„λ²„ μ‹¤ν–‰** (ν„°λ―Έλ„ 1):
    ```bash
    python server.py
    ```
2.  **λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈ μ„¤μ • λ° μ‹¤ν–‰** (ν„°λ―Έλ„ 2):
    * `robot_client.py`μ—μ„ `SERVER_IP = 'localhost'`λ΅ μ„¤μ •ν•©λ‹λ‹¤.
    * μ‹¤ν–‰: `python robot_client.py`
3.  **μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰** (ν„°λ―Έλ„ 3 λλ” μ›Ή λΈλΌμ°μ €):
    * **Python μ¤νΌλ μ΄ν„°**:
        * `operator_client.py`μ—μ„ `SERVER_IP = 'localhost'`λ΅ μ„¤μ •ν•©λ‹λ‹¤.
        * μ‹¤ν–‰: `python operator_client.py`
    * **μ›Ή μ¤νΌλ μ΄ν„°**:
        * μ›Ή λΈλΌμ°μ €μ—μ„ `http://localhost:25000` (λ΅λ΄‡κ³Ό λ™μΌν• `ROOM_ID`)λ΅ μ ‘μ†ν•©λ‹λ‹¤.

## 5. μ½”λ“ κµ¬μ΅° λ° μ£Όμ” νμΌ μ„¤λ… (Python μ¤‘μ‹¬)

* `server.py`: FastAPI κΈ°λ°μ WebRTC μ‹κ·Έλ„λ§ λ° λ©”μ‹μ§€ μ¤‘κ³„ μ„λ²„ λ΅μ§.
* `robot_client.py`: λ΅λ΄‡ μΈ΅ λ©”μΈ μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§. λ―Έλ””μ–΄ μ¤νΈλ¦¬λ° λ° μ μ–΄ λ…λ Ή μ²λ¦¬.
* `robot_peer_connection.py`: λ΅λ΄‡ μΈ΅μ `aiortc.RTCPeerConnection` λν•‘ λ° WebRTC μ΄λ²¤νΈ μ²λ¦¬.
* `operator_client.py`: Python (PySide6) μ¤νΌλ μ΄ν„° μΈ΅ λ©”μΈ μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§.
* `operator_peer_connection.py`: Python μ¤νΌλ μ΄ν„° μΈ΅μ `aiortc.RTCPeerConnection` λν•‘ λ° WebRTC μ΄λ²¤νΈ μ²λ¦¬.
* `operator_client.html`: JavaScriptλ¥Ό μ‚¬μ©ν• μ›Ή λΈλΌμ°μ € κΈ°λ° μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ UI λ° λ΅μ§.
* (κΈ°νƒ€ Python ν—¬νΌ λ¨λ“λ“¤: `camera_manager.py`, `audio_track.py` λ“±)

---

## 6. Unity μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈ μ„¤μ • λ° μ‹¤ν–‰

μ΄ μ„Ήμ…μ—μ„λ” Unity κ²μ„ μ—”μ§„μ„ μ‚¬μ©ν•μ—¬ μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈλ¥Ό μ„¤μ •ν•κ³  μ‹¤ν–‰ν•λ” λ°©λ²•μ„ μ•λ‚΄ν•©λ‹λ‹¤.

### 6.1. Unity ν™κ²½ μμ΅΄μ„±

* **Unity Editor**: `2022.3.6f1 LTS` (λλ” μ΄μ™€ νΈν™λλ” λ²„μ „) κ¶μ¥.
* **ν•„μ ν¨ν‚¤μ§€**: Unity ν”„λ΅μ νΈμ Unity Package Managerμ—μ„ `Add package from git URL...`μ—μ„ μ•„λλ¥Ό μ„¤μΉν•©λ‹λ‹¤.

    * **Newtonsoft.Json-for-Unity**:
        * https://github.com/jilleJr/Newtonsoft.Json-for-Unity.git#upm

    * **WebRTC Package for Unity**:
      * com.unity.webrtc@3.0.0-pre.8

### 6.2. ν”„λ΅μ νΈ ν΄λ” κµ¬μ„± λ° νμΌ μ„ν¬νΈ

μ΄ Python ν”„λ΅μ νΈ μ €μ¥μ†μ— ν¬ν•¨λ Unity κ΄€λ ¨ νμΌλ“¤μ„ μ‚¬μ©μμ Unity ν”„λ΅μ νΈλ΅ κ°€μ Έμµλ‹λ‹¤. (μ κ³µν•΄μ£Όμ‹  μ΄λ―Έμ§€ `image_766b4d.png` μ°Έκ³  μ‹, Python ν”„λ΅μ νΈ λ£¨νΈμ `unity/` ν΄λ” λ‚΄ `Scripts`μ™€ `Plugins` ν΄λ”κ°€ μλ” κµ¬μ΅°λ¥Ό κ°€μ •ν•©λ‹λ‹¤.)

1.  **νμΌ λ³µμ‚¬**:
    * λ³Έ μ €μ¥μ†μ `unity/Scripts/` ν΄λ” λ‚΄μ— μλ” λ¨λ“  `.cs` νμΌλ“¤μ„ μ‚¬μ©μμ **Unity ν”„λ΅μ νΈ `Assets/Scripts/` ν΄λ”** (λλ” μ›ν•λ” λ‹¤λ¥Έ μ΄λ¦„μ μ¤ν¬λ¦½νΈ ν΄λ”)λ΅ λ³µμ‚¬ν•©λ‹λ‹¤.
    * λ³Έ μ €μ¥μ†μ `unity/Plugins/` ν΄λ”κ°€ μκ³  κ·Έ μ•μ— `WebSocketSharp.dll`κ³Ό κ°™μ€ ν•„μ”ν• DLL νμΌμ΄ μλ‹¤λ©΄, ν•΄λ‹Ή DLL νμΌλ“¤μ„ μ‚¬μ©μμ **Unity ν”„λ΅μ νΈ `Assets/Plugins/` ν΄λ”**λ΅ λ³µμ‚¬ν•©λ‹λ‹¤.
        * **μ¤‘μ”**:
            * `Newtonsoft.Json`κ³Ό `com.unity.webrtc`λ” μ„ "6.1. Unity ν™κ²½ μμ΅΄μ„±"μ— λ”°λΌ UPMμΌλ΅ μ„¤μΉν•λ―€λ΅, ν•΄λ‹Ή DLLμ„ μ§μ ‘ `Plugins` ν΄λ”μ— λ„£μ„ ν•„μ”λ” μ—†μµλ‹λ‹¤.
            * `WebSocketSharp.dll` μ—­μ‹ UPM ν¨ν‚¤μ§€ (μ: νΉμ • UPM WebSocket ν΄λΌμ΄μ–ΈνΈ ν¨ν‚¤μ§€)λ¥Ό ν†µν•΄ κ΄€λ¦¬ν•κ³  μλ‹¤λ©΄ μ§μ ‘ λ³µμ‚¬ν•  ν•„μ”λ” μ—†μµλ‹λ‹¤. ν”„λ΅μ νΈμ—μ„ `WebSocketSharp` λ„¤μ„μ¤νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ―€λ΅, μ΄ λΌμ΄λΈλ¬λ¦¬κ°€ Unity ν”„λ΅μ νΈμ— ν¬ν•¨λμ–΄ μμ–΄μ•Ό ν•©λ‹λ‹¤.

2.  **Unity Editor ν™•μΈ**: Unity Editorμ—μ„ ν”„λ΅μ νΈλ¥Ό μ—΄κ³ , λ³µμ‚¬ν• μ¤ν¬λ¦½νΈλ“¤μ΄ μ •μƒμ μΌλ΅ μ»΄νμΌλλ”μ§€ Console μ°½μ„ ν†µν•΄ ν™•μΈν•©λ‹λ‹¤.

### 6.3. μ”¬(Scene) κµ¬μ„± λ° μ»΄ν¬λ„νΈ μ¶”κ°€ (Hierarchy μ°½ κΈ°μ¤€)

λ©”μΈ μ”¬(Scene)μ— λ‹¤μκ³Ό κ°™μ΄ κ²μ„ μ¤λΈμ νΈ(GameObject)λ¥Ό μ„¤μ •ν•©λ‹λ‹¤.

* **(ν•„μ/μλ™μƒμ„± κ°€λ¥) `MainThreadDispatcher` μ¤λΈμ νΈ**:
    * μ΄λ¦„: `MainThreadDispatcher`
    * μ»΄ν¬λ„νΈ: `UnityMainThreadDispatcher.cs`
    * *μ°Έκ³ : μ΄ μ¤ν¬λ¦½νΈλ” μ½”λ“ λ‚΄μ—μ„ `Instance()` νΈμ¶ μ‹ μ”¬μ— μ—†μΌλ©΄ μλ™μΌλ΅ μƒμ„±λ  μ μμµλ‹λ‹¤.*

* **`WebRTC_System` μ¤λΈμ νΈ** (μ¤‘μ•™ κ΄€λ¦¬μ©):
    * μ΄λ¦„: `WebRTC_System`
    * μ»΄ν¬λ„νΈ:
        * `WebRTCManager.cs`
        * `WebSocketClient.cs`
        * `AudioReceiver.cs` (μ¤λ””μ¤ μμ‹  μ‹)
        * `DataReceiver.cs` (λ°μ΄ν„° μ±„λ„ μμ‹  μ‹)
        * *(μ„ νƒ)* `DataSender.cs` (λ°μ΄ν„° μ±„λ„ μ†΅μ‹  ν…μ¤νΈμ©)

* **UI λΉ„λ””μ¤ ν‘μ‹μ© μ¤λΈμ νΈ**:
    1.  **Canvas μƒμ„±**: Hierarchy μ°½ > UI > Canvas.
    2.  **RawImage μƒμ„±**: Canvas ν•μ„μ— UI > Raw Image.
        * μ΄λ¦„: `VideoDisplayImage`
        * μ»΄ν¬λ„νΈ: `VideoReceiver.cs` (μ΄ μ¤λΈμ νΈμ— μ¶”κ°€)

### 6.4. μ»΄ν¬λ„νΈ κ°„ μ—°κ²° μ„¤μ • (Inspector μ°½ κΈ°μ¤€)

* **`WebRTC_System` κ²μ„ μ¤λΈμ νΈ μ„ νƒ μ‹**:
    * `WebRTC Manager (Script)` μ»΄ν¬λ„νΈ:
        * **`Server Ip`**: μ„λ²„ IP μ£Όμ† (μ: "localhost").
        * **`Server Port`**: μ„λ²„ ν¬νΈ (μ: 25000).
        * **`Room Id`**: λ°© ID (μ: "test_room").
        * **`Video Receiver`**: `VideoDisplayImage` κ²μ„ μ¤λΈμ νΈλ¥Ό λ“λκ·Έν•μ—¬ ν• λ‹Ή.
        * **`Audio Receiver`**: `WebRTC_System` μ¤λΈμ νΈ μμ‹  (λλ” `AudioReceiver`κ°€ μλ” λ‹¤λ¥Έ μ¤λΈμ νΈ)μ„ λ“λκ·Έν•μ—¬ ν• λ‹Ή.

* **`VideoDisplayImage` κ²μ„ μ¤λΈμ νΈ μ„ νƒ μ‹**:
    * `Video Receiver (Script)` μ»΄ν¬λ„νΈ:
        * **`Display Image`**: `VideoDisplayImage` μ¤λΈμ νΈ μμ‹ μ `Raw Image` μ»΄ν¬λ„νΈλ¥Ό λ“λκ·Έν•μ—¬ ν• λ‹Ή.

### 6.5. Unity μ¤νΌλ μ΄ν„° μ‹¤ν–‰ λ° ν…μ¤νΈ

1.  λ¨λ“  μ„¤μ •κ³Ό μ—°κ²°μ΄ μ™„λ£λμ—λ”μ§€ ν™•μΈ ν›„ μ”¬μ„ μ €μ¥ν•©λ‹λ‹¤.
2.  Python μ‹κ·Έλ„λ§ μ„λ²„ (`server.py`)μ™€ λ΅λ΄‡ ν΄λΌμ΄μ–ΈνΈ (`robot_client.py`)κ°€ μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈν•©λ‹λ‹¤.
3.  Unity Editorμ—μ„ Play λ²„νΌμ„ λλ¬ μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‹¤ν–‰ν•κ³  μ—°κ²°μ„ ν…μ¤νΈν•©λ‹λ‹¤.
    * λ΅μ»¬ ν…μ¤νΈ μ‹ `WebRTCManager`μ `Server Ip`λ¥Ό "localhost"λ΅ μ„¤μ •ν•©λ‹λ‹¤.

### 6.6. Unity κ΄€λ ¨ μ£Όμ” μ¤ν¬λ¦½νΈ μ„¤λ…

* `UnityMainThreadDispatcher.cs`: Unity λ©”μΈ μ¤λ λ“μ—μ„ μ‘μ—…μ„ μ‹¤ν–‰ν•κΈ° μ„ν• ν—¬νΌ μ¤ν¬λ¦½νΈ. λΉ„λ™κΈ° μ½λ°± λ“±μ„ μ•μ „ν•κ² μ²λ¦¬.
* `WebRTCManager.cs`: Unity μ¤νΌλ μ΄ν„°μ WebRTC μ—°κ²° μ„¤μ •, μ‹κ·Έλ„λ§, λ―Έλ””μ–΄ μμ‹ /μ†΅μ‹ , λ°μ΄ν„° μ±„λ„ λ“±μ„ μ΄κ΄„ν•λ” ν•µμ‹¬ κ΄€λ¦¬μ.
* `SignalingMessage.cs`: μ„λ²„μ™€ μ£Όκ³ λ°›λ” μ‹κ·Έλ„λ§ λ©”μ‹μ§€(Offer, Answer, Candidate λ“±)μ C# λ°μ΄ν„° κµ¬μ΅° μ •μ. (JSON μ§λ ¬ν™”/μ—­μ§λ ¬ν™” λ€μƒ)
* `VideoReceiver.cs`: μμ‹ λ λΉ„λ””μ¤ νΈλ™μ„ Unity UIμ `RawImage`μ— λ λ”λ§.
* `AudioReceiver.cs`: μμ‹ λ μ¤λ””μ¤ νΈλ™μ„ `AudioSource`λ¥Ό ν†µν•΄ μ¬μƒ.
* `DataReceiver.cs`: λ°μ΄ν„° μ±„λ„μ„ ν†µν•΄ μμ‹ λ ν…μ¤νΈ λ©”μ‹μ§€ μ²λ¦¬.
* `WebSocketClient.cs`: μ§€μ •λ WebSocket μ„λ²„μ™€μ μ—°κ²° λ° λ©”μ‹μ§€ μ†΅μμ‹  λ‹΄λ‹Ή.
* `DataSender.cs`: λ°μ΄ν„° μ±„λ„μ„ ν†µν•΄ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•λ” μμ  μ¤ν¬λ¦½νΈ.

### Unity μ¤νΌλ μ΄ν„°μ VR μ»¨νΈλ΅¤λ¬ λ°μ΄ν„° μ „μ†΅ ν•μ‹

Unity μ¤νΌλ μ΄ν„° ν΄λΌμ΄μ–ΈνΈμ—μ„ λ΅λ΄‡μΌλ΅ μ „μ†΅λλ” VR μ»¨νΈλ΅¤λ¬ μ…λ ¥ λ°μ΄ν„°λ” WebRTC λ°μ΄ν„° μ±„λ„μ„ ν†µν•΄ JSON ν•μ‹μΌλ΅ μ „λ‹¬λ©λ‹λ‹¤. μ΄ λ°μ΄ν„°λ” μ»¨νΈλ΅¤λ¬μ ν„μ¬ μƒνƒλ¥Ό λ‚νƒ€λ‚΄λ©°, μ£ΌκΈ°μ μΌλ΅ (μ: 100ms λ§λ‹¤) μ „μ†΅λ  μ μμµλ‹λ‹¤.

**μµμƒμ„ JSON κ°μ²΄ κµ¬μ΅° (`VRControllerPayload`):**

* `topic` (string): λ©”μ‹μ§€μ μΆ…λ¥λ¥Ό λ‚νƒ€λƒ…λ‹λ‹¤. VR μ»¨νΈλ΅¤λ¬ λ°μ΄ν„°μ κ²½μ° ν•­μƒ `"vr_controller"`μ…λ‹λ‹¤.
* `target` (string): λ©”μ‹μ§€λ¥Ό μμ‹ ν•  λ€μƒ IDμ…λ‹λ‹¤. μΌλ°μ μΌλ΅ νΉμ • λ΅λ΄‡ ID λλ” λ¨λ“  λ€μƒ(`"all"`)μΌλ΅ μ„¤μ •λ©λ‹λ‹¤.
* `value` 
  * `left` (object): μ™Όμ† μ»¨νΈλ΅¤λ¬μ μƒμ„Έ μ…λ ¥ λ°μ΄ν„°λ¥Ό λ‹΄λ” κ°μ²΄μ…λ‹λ‹¤. (μ•„λ `ControllerInput μƒμ„Έ κµ¬μ΅°` μ°Έκ³ )
  * `right` (object): μ¤λ¥Έμ† μ»¨νΈλ΅¤λ¬μ μƒμ„Έ μ…λ ¥ λ°μ΄ν„°λ¥Ό λ‹΄λ” κ°μ²΄μ…λ‹λ‹¤. (μ•„λ `ControllerInput μƒμ„Έ κµ¬μ΅°` μ°Έκ³ )

**μ»¨νΈλ΅¤λ¬ μ…λ ¥ μƒμ„Έ κµ¬μ΅° (`ControllerInput` - `left` λλ” `right` κ°μ²΄ λ‚΄λ¶€):**

* `axes` (array of float): μ•„λ‚ λ΅κ·Έ μ…λ ¥ κ°’λ“¤μ λ°°μ—΄μ…λ‹λ‹¤. κ°’μ λ²”μ„μ™€ μμ„λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.
    * `[0]`: μΈμ¤ν‹±(Thumbstick) Xμ¶• κ°’. λ²”μ„: `-1.0` (μ™Όμ½) ~ `1.0` (μ¤λ¥Έμ½), μ¤‘μ•™ `0.0`.
    * `[1]`: μΈμ¤ν‹±(Thumbstick) Yμ¶• κ°’. λ²”μ„: `-1.0` (μ•„λ) ~ `1.0` (μ„), μ¤‘μ•™ `0.0`.
    * `[2]`: νΈλ¦¬κ±°(Trigger)λ¥Ό λ„λ¥Έ μ •λ„. λ²”μ„: `0.0` (λ„λ¥΄μ§€ μ•μ) ~ `1.0` (μ™„μ „ν λ„λ¦„).
    * `[3]`: κ·Έλ¦½(Grip) λ²„νΌμ„ μ¥” μ •λ„. λ²”μ„: `0.0` (μ¥μ§€ μ•μ) ~ `1.0` (μ™„μ „ν μ¥ ).
* `buttons` (array of boolean): λ²„νΌ λ° μ…λ ¥ μ¥μΉμ λ¬Όλ¦¬μ μΈ 'λλ¦Ό(Press)' μƒνƒ λ°°μ—΄μ…λ‹λ‹¤. **λ°°μ—΄ μ”μ†μ μμ„κ°€ μ¤‘μ”ν•©λ‹λ‹¤.**
    * `[0]`: μ£Ό λ²„νΌ(Primary Button: Meta Questμ—μ„ A λλ” X λ²„νΌ) λλ¦Ό μ—¬λ¶€ (`true`/`false`).
    * `[1]`: λ³΄μ΅° λ²„νΌ(Secondary Button: Meta Questμ—μ„ B λλ” Y λ²„νΌ) λλ¦Ό μ—¬λ¶€.
    * `[2]`: μΈμ¤ν‹±(Thumbstick) ν΄λ¦­(Press) μ—¬λ¶€.
    * `[3]`: νΈλ¦¬κ±°(Trigger)κ°€ μΌμ • μμ¤€ μ΄μƒ λ‹Ήκ²¨μ Έ 'λλ¦Ό'μΌλ΅ κ°„μ£Όλλ”μ§€ μ—¬λ¶€.
    * `[4]`: κ·Έλ¦½(Grip) λ²„νΌμ΄ μΌμ • μμ¤€ μ΄μƒ μ¥μ–΄μ Έ 'λλ¦Ό'μΌλ΅ κ°„μ£Όλλ”μ§€ μ—¬λ¶€.
    * `[5]`: λ©”λ‰΄ λ²„νΌ(Menu Button) λλ¦Ό μ—¬λ¶€ (λ³΄ν†µ μ™Όμ† μ»¨νΈλ΅¤λ¬μ—λ§ μμΌλ©°, μ¤λ¥Έμ† μ»¨νΈλ΅¤λ¬μ κ²½μ° μ΄ κ°’μ€ ν•­μƒ `false`λ΅ μ „μ†΅λ©λ‹λ‹¤).
* `touch` (array of boolean): λ²„νΌ λ° μ…λ ¥ μ¥μΉ ν‘λ©΄μ— μ†κ°€λ½μ΄ 'μ ‘μ΄‰(Touch)'ν–λ”μ§€ μ—¬λ¶€λ¥Ό λ‚νƒ€λ‚΄λ” μƒνƒ λ°°μ—΄μ…λ‹λ‹¤. **λ°°μ—΄ μ”μ†μ μμ„κ°€ μ¤‘μ”ν•©λ‹λ‹¤.**
    * `[0]`: μ£Ό λ²„νΌ(Primary Button: A/X) ν„°μΉ μ—¬λ¶€.
    * `[1]`: λ³΄μ΅° λ²„νΌ(Secondary Button: B/Y) ν„°μΉ μ—¬λ¶€.
    * `[2]`: μΈμ¤ν‹±(Thumbstick) ν„°μΉ μ—¬λ¶€.
* `position` (array of float): μ»¨νΈλ΅¤λ¬μ ν„μ¬ μ„μΉλ¥Ό λ‚νƒ€λ‚΄λ” λ°°μ—΄ `[x, y, z]`μ…λ‹λ‹¤. Unity μ›”λ“ μΆν‘κ³„λ¥Ό κΈ°μ¤€μΌλ΅ ν•©λ‹λ‹¤.
* `rotation` (array of float): μ»¨νΈλ΅¤λ¬μ ν„μ¬ νμ „ μƒνƒλ¥Ό λ‚νƒ€λ‚΄λ” μΏΌν„°λ‹μ–Έ(Quaternion) λ°°μ—΄ `[x, y, z, w]`μ…λ‹λ‹¤. Unity μ›”λ“ μΆν‘κ³„λ¥Ό κΈ°μ¤€μΌλ΅ ν•©λ‹λ‹¤.

**JSON μ „μ†΅ μμ‹:**

```json
{
  "topic": "vr_controller",
  "target": "all",
  "left": {
    "axes": [
      -0.15,  // μΈμ¤ν‹± X
      0.80,   // μΈμ¤ν‹± Y
      0.0,    // νΈλ¦¬κ±° κ°’
      0.25    // κ·Έλ¦½ κ°’
    ],
    "buttons": [
      false,  // μ£Ό λ²„νΌ λλ¦Ό
      true,   // λ³΄μ΅° λ²„νΌ λλ¦Ό
      false,  // μΈμ¤ν‹± ν΄λ¦­
      false,  // νΈλ¦¬κ±° λλ¦Ό
      true,   // κ·Έλ¦½ λλ¦Ό
      false   // λ©”λ‰΄ λ²„νΌ λλ¦Ό
    ],
    "touch": [
      false,  // μ£Ό λ²„νΌ ν„°μΉ
      true,   // λ³΄μ΅° λ²„νΌ ν„°μΉ
      true    // μΈμ¤ν‹± ν„°μΉ
    ],
    "position": [-0.27, 0.75, 0.48],
    "rotation": [0.10, -0.15, -0.30, -0.92]
  },
  "right": {
    "axes": [
      0.0,    // μΈμ¤ν‹± X
      0.0,    // μΈμ¤ν‹± Y
      0.95,   // νΈλ¦¬κ±° κ°’
      0.0     // κ·Έλ¦½ κ°’
    ],
    "buttons": [
      true,   // μ£Ό λ²„νΌ λλ¦Ό
      false,  // λ³΄μ΅° λ²„νΌ λλ¦Ό
      false,  // μΈμ¤ν‹± ν΄λ¦­
      true,   // νΈλ¦¬κ±° λλ¦Ό
      false,  // κ·Έλ¦½ λλ¦Ό
      false   // λ©”λ‰΄ λ²„νΌ λλ¦Ό (μ¤λ¥Έμ†μ΄λ―€λ΅ ν•­μƒ false)
    ],
    "touch": [
      true,   // μ£Ό λ²„νΌ ν„°μΉ
      false,  // λ³΄μ΅° λ²„νΌ ν„°μΉ
      false   // μΈμ¤ν‹± ν„°μΉ
    ],
    "position": [0.22, 0.81, 0.41],
    "rotation": [-0.20, -0.10, 0.50, 0.80]
  }
}

## 7. λ¬Έμ  ν•΄κ²° λ° μ¶”κ°€ μ •λ³΄

* **λ°©ν™”λ²½ μ„¤μ •**: μ›κ²©μ—μ„ μ ‘μ† μ‹ μ„λ²„ PCμ λ°©ν™”λ²½μ—μ„ ν•΄λ‹Ή ν¬νΈ(κΈ°λ³Έκ°’: 25000)κ°€ μ—΄λ ¤ μλ”μ§€ ν™•μΈν•μ„Έμ”. κ³µμ κΈ° μ‚¬μ© μ‹ ν¬νΈ ν¬μ›λ”© μ„¤μ •μ΄ ν•„μ”ν•  μ μμµλ‹λ‹¤.
* **STUN μ„λ²„**: WebRTC μ—°κ²°μ„ μ„ν•΄ STUN μ„λ²„(`stun:stun.l.google.com:19302`)λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤. λ„¤νΈμ›ν¬ ν™κ²½μ— λ”°λΌ λ‹¤λ¥Έ STUN/TURN μ„λ²„ μ„¤μ •μ΄ ν•„μ”ν•  μ μμµλ‹λ‹¤.
* **Python λΌμ΄λΈλ¬λ¦¬ λ²„μ „**: λ…μ‹λ λΌμ΄λΈλ¬λ¦¬ μ™Έμ— `pyaudio` λ“±μ€ μ΄μμ²΄μ μ— λ§λ” μ¶”κ°€μ μΈ μ„¤μ •μ΄λ‚ μ»΄νμΌλ λ°”μ΄λ„λ¦¬κ°€ ν•„μ”ν•  μ μμµλ‹λ‹¤.

---

μ΄ READMEκ°€ ν”„λ΅μ νΈλ¥Ό μ΄ν•΄ν•κ³  μ‚¬μ©ν•λ” λ° λ„μ›€μ΄ λκΈΈ λ°”λλ‹λ‹¤! π